<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>경사 계산기</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    h2 {
      font-size: 24px;
    }
    input, select {
      width: 300px;
      padding: 8px;
      margin-bottom: 10px;
    }
    button {
      padding: 10px 20px;
      background-color: #4CAF50;
      color: white;
      border: none;
    }
    canvas {
      border: 1px solid #ccc;
      margin-top: 20px;
    }
  </style>
</head>
<body>

<h2>경사 계산기</h2>

<label>높이 (mm):</label><br>
<input id="height" type="number" value="3000"><br>

<label>거리 (mm):</label><br>
<input id="distance" type="number" value="2000"><br>

<label>외경 (mm):</label><br>
<input id="diameter" type="number" value="50"><br>

<label>배관 방향:</label><br>
<select id="direction">
  <option value="left">좌측</option>
  <option value="right" selected>우측</option>
</select><br>

<button onclick="calculate()">계산하기</button>

<div id="result" style="margin-top:20px; font-size: 15px;"></div>

<canvas id="pipeCanvas" width="500" height="400"></canvas>

<script>
  function calculate() {
    const h = parseFloat(document.getElementById("height").value);
    const d = parseFloat(document.getElementById("distance").value);
    const dia = parseFloat(document.getElementById("diameter").value);
    const dir = document.getElementById("direction").value;

    if (isNaN(h) || isNaN(d) || isNaN(dia) || dia <= 0) {
      alert("모든 값을 올바르게 입력해주세요.");
      return;
    }

    const slopePercent = (h / d) * 100;
    const angleDeg = Math.atan(h / d) * (180 / Math.PI);
    const hypotenuse = Math.sqrt(h * h + d * d);

    // 엘보 기준 벤딩 치수 (단순 계산)
    const bendLeft = d - dia * 1.5;
    const bendRight = h - dia * 1.5;

    const resultHTML = `
      <b>높이:</b> ${h.toFixed(2)}mm<br>
      <b>거리:</b> ${d.toFixed(2)}mm<br>
      <b>외경:</b> ${dia.toFixed(2)}mm<br>
      <b>경사율:</b> ${slopePercent.toFixed(2)}%<br>
      <b>경사각도:</b> ${angleDeg.toFixed(2)}°<br>
      <b>대각선 거리:</b> ${hypotenuse.toFixed(2)}mm<br><br>
      <b>엘보 기준 벤딩 치수</b><br>
      좌측 치수: ${bendLeft > 0 ? bendLeft.toFixed(2) + "mm" : "계산불가"}<br>
      우측 치수: ${bendRight > 0 ? bendRight.toFixed(2) + "mm" : "계산불가"}<br>
    `;

    document.getElementById("result").innerHTML = resultHTML;
    drawPipeDiagram(h, d, dia, dir);
  }

  function drawPipeDiagram(h, d, dia, dir) {
    const canvas = document.getElementById("pipeCanvas");
    const ctx = canvas.getContext("2d");
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    const scale = 300 / Math.max(h, d); // 적절한 비율로 줄이기
    const offsetX = 100;
    const offsetY = 350;

    const pxH = h * scale;
    const pxD = d * scale;
    const pxDia = dia * scale;

    // 라인 시작점
    const startX = dir === "right" ? offsetX : offsetX + pxD;
    const startY = offsetY;

    // 수평 라인
    ctx.beginPath();
    ctx.moveTo(startX, startY);
    ctx.lineTo(startX + (dir === "right" ? pxD : -pxD), startY);
    ctx.strokeStyle = "black";
    ctx.lineWidth = 2;
    ctx.stroke();

    // 수직 라인
    ctx.beginPath();
    ctx.moveTo(startX + (dir === "right" ? pxD : -pxD), startY);
    ctx.lineTo(startX + (dir === "right" ? pxD : -pxD), startY - pxH);
    ctx.stroke();

    // 대각선 배관
    ctx.beginPath();
    ctx.moveTo(startX, startY);
    ctx.lineTo(startX + (dir === "right" ? pxD : -pxD), startY - pxH);
    ctx.strokeStyle = "red";
    ctx.lineWidth = 2;
    ctx.stroke();

    // 라벨
    ctx.fillStyle = "black";
    ctx.font = "12px Arial";
    ctx.fillText("거리", startX + (dir === "right" ? pxD/2 - 10 : -pxD/2 - 20), startY + 15);
    ctx.fillText("높이", startX + (dir === "right" ? pxD : -pxD) + 5, startY - pxH/2);
    ctx.fillText("대각선", startX + (dir === "right" ? pxD/2 : -pxD/2) - 15, startY - pxH/2);

    // 엘보 위치 원
    ctx.beginPath();
    ctx.arc(startX + (dir === "right" ? pxD : -pxD), startY, pxDia/2, 0, 2 * Math.PI);
    ctx.strokeStyle = "blue";
    ctx.stroke();
  }
</script>

</body>
</html>
